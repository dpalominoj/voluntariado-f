{% extends "base.html" %}

{% block title %}Inicio - KONECTAi{% endblock %}

{% block content %}
  <!-- Hero -->
  <div class="bg-indigo-600 text-white pt-[150px] pb-[80px]" style="background-image: url('data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');">
    <div class="hcont cont flex flex-row justify-between container mx-auto px-4">
      <div class="texto-hero w-1/2">
        <h1 class="text-4xl m-0">Voluntariado Inclusivo<br><span class="text-white/70">Para un mundo mejor</span></h1>
        <p>√önete a nuestra comunidad de voluntarios y marca la diferencia en la vida de quienes m√°s lo necesitan. Creamos espacios inclusivos donde todos pueden participar.</p>
        <div class="bot-hero mt-4 flex gap-4">
          <button class="btn-p bg-white text-indigo-600" onclick="abrirRegistro()">Comenzar ahora</button> <!-- Assuming --primario is indigo-600 -->
          <button class="btn-s" ><a href="{{ url_for('main.dashboard') }}">Conocer m√°s</a></button>
        </div>
      </div>
      <div class="img-hero" >
		<svg class="hero-svg w-full max-w-md h-auto block" viewBox="0 0 500 400" xmlns="http://www.w3.org/2000/svg">
			<circle cx="250" cy="150" r="100" fill="#ffffff" fill-opacity="0.2"></circle>
			<g transform="translate(150, 50)">
				<circle cx="50" cy="50" r="40" fill="#ffffff"></circle>
				<circle cx="65" cy="40" r="10" fill="#4f46e5"></circle>
				<circle cx="35" cy="40" r="10" fill="#4f46e5"></circle>
				<path d="M30,65 Q50,80 70,65" stroke="#4f46e5" stroke-width="3" fill="none"></path>
			</g>
			<g transform="translate(250, 50)">
				<circle cx="50" cy="50" r="40" fill="#ffffff"></circle>
				<circle cx="65" cy="40" r="10" fill="#4f46e5"></circle>
				<circle cx="35" cy="40" r="10" fill="#4f46e5"></circle>
				<path d="M30,65 Q50,80 70,65" stroke="#4f46e5" stroke-width="3" fill="none"></path>
			</g>
			<g transform="translate(200, 150)">
				<circle cx="50" cy="50" r="40" fill="#ffffff"></circle>
				<circle cx="65" cy="40" r="10" fill="#4f46e5"></circle>
				<circle cx="35" cy="40" r="10" fill="#4f46e5"></circle>
				<path d="M30,65 Q50,80 70,65" stroke="#4f46e5" stroke-width="3" fill="none"></path>
			</g>
			<path d="M200,100 Q250,50 300,100" stroke="#ffffff" stroke-width="3" fill="none"></path>
			<path d="M200,200 Q250,250 300,200" stroke="#ffffff" stroke-width="3" fill="none"></path>
			<path d="M250,150 L250,200" stroke="#ffffff" stroke-width="3" fill="none"></path>
		</svg>
      </div>
    </div>
  </div>

  <main>
    <!-- Programas -->
    <section class="prog">
      <h1>Nuestros Programas de Voluntariado</h1>
      <p>Ofrecemos oportunidades seg√∫n tus habilidades e intereses.</p>
      <div class="carousel-container relative overflow-hidden w-4/5 mx-auto mt-8 mb-8" role="region" aria-roledescription="carousel" aria-label="Nuestros Programas de Voluntariado">
        <div id="programas-carousel-track" class="cards carousel-track flex transition-transform duration-500 ease-in-out" aria-live="off">
          <article class="card carousel-slide w-full flex-shrink-0 box-border px-2.5" role="group" aria-roledescription="slide">
            <div class="icono i1">üåª</div>
            <div class="cuerpo">
              <h3>Educaci√≥n Inclusiva</h3>
              <p>Apoya a estudiantes con necesidades especiales.</p>
              <button class="btn-p"><a class="a-particip" href="{{ url_for('main.voluntario') }}">Participar</a></button>
            </div>
          </article>
          <article class="card carousel-slide w-full flex-shrink-0 box-border px-2.5" role="group" aria-roledescription="slide">
            <div class="icono i2">üåº</div>
            <div class="cuerpo">
              <h3>Medio Ambiente</h3>
              <p>Participa en proyectos de reforestaci√≥n.</p>
              <button class="btn-p"><a class="a-particip" href="{{ url_for('main.organizador') }}">Participar</a></button>
            </div>
          </article>
          <article class="card carousel-slide w-full flex-shrink-0 box-border px-2.5" role="group" aria-roledescription="slide">
            <div class="icono i3">üå∏</div>
            <div class="cuerpo">
              <h3>Apoyo Comunitario</h3>
              <p>Colabora en comedores sociales y visitas a residencias de ancianos.</p>
              <button class="btn-p"><a class="a-particip" href="{{ url_for('main.administrador') }}">Participar</a></button>
            </div>
          </article>
        </div>
        <button class="carousel-button prev absolute top-1/2 -translate-y-1/2 bg-white/70 hover:bg-white border border-gray-300 p-2.5 cursor-pointer z-[100] rounded-full text-gray-700 text-xl left-[-20px] leading-none" aria-label="Previous program" aria-controls="programas-carousel-track">‚Äπ</button>
        <button class="carousel-button next absolute top-1/2 -translate-y-1/2 bg-white/70 hover:bg-white border border-gray-300 p-2.5 cursor-pointer z-[100] rounded-full text-gray-700 text-xl right-[-20px] leading-none" aria-label="Next program" aria-controls="programas-carousel-track">‚Ä∫</button>
      </div>
    </section>

    <!-- Impacto -->
    <section class="impacto">
      <h2>Nuestro Impacto</h2>
      <p>Juntos construimos un mundo m√°s inclusivo.</p>
      <div class="stats">
        <div class="item">
          <div class="ic-i"><!-- svg -->üßë‚Äçüíª</div>
          <h3>5,000+</h3>
          <p>Voluntarios activos</p>
        </div>
        <div class="item">
          <div class="ic-i"><!-- svg -->üè¢</div>
          <h3>120+</h3>
          <p>Proyectos realizados</p>
        </div>
		<div class="item">
          <div class="ic-i"><!-- svg -->üìç</div>
          <h3>50+</h3>
          <p>Comunidades beneficiadas</p>
        </div>
      </div>
    </section>

    <!-- Testimonios -->
    <section class="test">
      <h2>Testimonios</h2>
      <p>Conoce las experiencias de nuestros voluntarios.</p>
      <div class="test-cards">
        <div class="test-card">
          <div class="encab">
			<div class="avatar">M</div>
			<h4>Mar√≠a Gonz√°lez</h4>
		  </div>
		  <p>Voluntaria desde 2020</p>
          <p>"Participar en los programas de voluntariado inclusivo ha sido una de las experiencias m√°s enriquecedoras de mi vida."</p>
        </div>
		<div class="test-card">
          <div class="encab">
			<div class="avatar">J</div>
			<h4>Juan P√©rez</h4>
		  </div>
		  <p>Beneficiario</p>
          <p>"Gracias a los programas educativos inclusivos, mi hijo ha podido desarrollar habilidades que pens√°bamos imposibles."</p>
        </div>
		<div class="test-card">
          <div class="encab">
			<div class="avatar">L</div>
			<h4>Laura Mart√≠nez</h4>
		  </div>
		  <p>Coordinadora</p>
          <p>"Ver c√≥mo personas de diferentes capacidades trabajan juntas por un objetivo com√∫n es inspirador."</p>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="cta">
      <h2>¬øListo para unirte?</h2>
      <p>Ay√∫danos a construir un mundo inclusivo.</p>
      <button id="ctaSignUpBtn" class="btn-p" onclick="abrirRegistro()">Registrarse ahora</button>
    </section>
  </main>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const track = document.querySelector('.carousel-track');
    if (!track) {
        console.warn('Carousel track not found');
        return;
    }
    const slides = Array.from(track.querySelectorAll('.carousel-slide'));
    const nextButton = document.querySelector('.carousel-button.next');
    const prevButton = document.querySelector('.carousel-button.prev');

    if (!nextButton || !prevButton || slides.length === 0) {
        console.warn('Carousel buttons or slides not found. Slides count:', slides.length);
        return;
    }

    let slideWidth = 0; // Will be calculated
    let currentIndex = 0;

    const updateAriaLabels = () => {
        slides.forEach((slide, index) => {
            const slideTitleElement = slide.querySelector('h3');
            const slideTitle = slideTitleElement ? slideTitleElement.textContent.trim() : '';
            slide.setAttribute('aria-label', `Programa ${index + 1} de ${slides.length}${slideTitle ? ': ' + slideTitle : ''}`);
        });
    };

    const calculateAndSetSlideWidth = () => {
        if (slides.length > 0) {
            // Ensure slides are visible before calculating width
            // Temporarily remove transform to get accurate width if needed, then reapply
            // However, getBoundingClientRect should work even with transform
            slideWidth = slides[0].getBoundingClientRect().width;
            if (slideWidth === 0) {
                console.warn("Calculated slideWidth is 0. Carousel might not work as expected if slides are hidden initially.");
            }
        }
        return slideWidth;
    };

    const updateCarouselVisuals = () => {
        if (slideWidth > 0) {
            track.style.transform = 'translateX(-' + (slideWidth * currentIndex) + 'px)';
        }
        slides.forEach((slide, index) => {
            if (index === currentIndex) {
                slide.classList.remove('opacity-50'); // Example: current slide is fully visible
                slide.setAttribute('aria-hidden', 'false');
            } else {
                slide.classList.add('opacity-50'); // Example: non-current slides are dimmed
                slide.setAttribute('aria-hidden', 'true');
            }
        });
    };

    const moveToSlide = (newIndex) => {
        currentIndex = newIndex;
        updateCarouselVisuals();
    };

    prevButton.addEventListener('click', () => {
        let newIndex = currentIndex - 1;
        if (newIndex < 0) {
            newIndex = slides.length - 1;
        }
        moveToSlide(newIndex);
    });

    nextButton.addEventListener('click', () => {
        let newIndex = currentIndex + 1;
        if (newIndex >= slides.length) {
            newIndex = 0;
        }
        moveToSlide(newIndex);
    });

    const initializeCarousel = () => {
        updateAriaLabels();

        // Delay initial width calculation and position update slightly
        // to ensure all CSS has been applied and elements are rendered.
        setTimeout(() => {
            if (calculateAndSetSlideWidth() > 0) {
                updateCarouselVisuals();
            } else {
                // Fallback or retry if width is still 0
                console.warn("Slide width is 0 after initial timeout. Retrying calculation...");
                setTimeout(() => {
                    if(calculateAndSetSlideWidth() > 0) {
                        updateCarouselVisuals();
                    } else {
                        console.error("Slide width remained 0. Carousel may not display correctly.");
                    }
                }, 500); // Longer delay for a second attempt
            }
        }, 100); // Initial short delay
    };

    initializeCarousel();

    window.addEventListener('resize', () => {
        // Consider debouncing or throttling this for performance
        if (calculateAndSetSlideWidth() > 0) {
            updateCarouselVisuals(); // Update position based on new width and current index
        }
    });
});
</script>
{% endblock %}
