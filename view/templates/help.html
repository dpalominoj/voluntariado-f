{% extends "base.html" %}

{% block title %}Ayuda - KONECTAi{% endblock %}

{% block content %}
<div class="bg-gray-50 py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="lg:text-center">
            <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                Centro de Ayuda y Soporte
            </h2>
            <p class="mt-4 max-w-2xl text-xl text-gray-600 lg:mx-auto">
                Encuentra respuestas a preguntas comunes y aprende cómo usar KONECTAi.
            </p>
        </div>

        <div class="mt-12 max-w-3xl mx-auto">
            <h3 class="text-2xl font-semibold text-gray-900 mb-6 text-center">Preguntas Frecuentes</h3>
            <div x-data="{ openAccordion: 1 }" class="space-y-4">
                {# Accordion Item 1 #}
                <div class="border border-gray-200 rounded-lg">
                    <button @click="openAccordion === 1 ? openAccordion = null : openAccordion = 1" class="w-full flex items-center justify-between p-4 sm:p-6 text-left text-gray-700 hover:bg-gray-100 focus:outline-none">
                        <span class="text-lg font-medium">¿Cómo me inscribo como voluntario?</span>
                        <svg class="w-6 h-6 transform transition-transform duration-200" :class="{ 'rotate-180': openAccordion === 1 }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div x-show="openAccordion === 1" x-cloak x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95" class="p-4 sm:p-6 border-t border-gray-200">
                        <p class="text-base text-gray-600">
                            Para inscribirte como voluntario, primero necesitarás crear una cuenta. Una vez registrado, podrás explorar los programas y actividades disponibles e inscribirte en aquellos que te interesen.
                        </p>
                    </div>
                </div>

                {# Accordion Item 2 #}
                <div class="border border-gray-200 rounded-lg">
                    <button @click="openAccordion === 2 ? openAccordion = null : openAccordion = 2" class="w-full flex items-center justify-between p-4 sm:p-6 text-left text-gray-700 hover:bg-gray-100 focus:outline-none">
                        <span class="text-lg font-medium">¿Cómo puedo listar los programas de mi organización?</span>
                        <svg class="w-6 h-6 transform transition-transform duration-200" :class="{ 'rotate-180': openAccordion === 2 }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div x-show="openAccordion === 2" x-cloak x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95" class="p-4 sm:p-6 border-t border-gray-200">
                        <p class="text-base text-gray-600">
                            Si eres un organizador, necesitarás una cuenta de 'Organizador'. Una vez aprobada, tendrás acceso a un panel donde podrás crear y gestionar tus programas y actividades.
                        </p>
                    </div>
                </div>

                {# Accordion Item 3 - Contact #}
                <div class="border border-gray-200 rounded-lg">
                    <button @click="openAccordion === 3 ? openAccordion = null : openAccordion = 3" class="w-full flex items-center justify-between p-4 sm:p-6 text-left text-gray-700 hover:bg-gray-100 focus:outline-none">
                        <span class="text-lg font-medium">¿A quién contacto para obtener ayuda?</span>
                        <svg class="w-6 h-6 transform transition-transform duration-200" :class="{ 'rotate-180': openAccordion === 3 }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div x-show="openAccordion === 3" x-cloak x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95" class="p-4 sm:p-6 border-t border-gray-200">
                        <p class="text-base text-gray-600">
                            Para cualquier problema o pregunta no cubierta aquí, por favor contacta a nuestro equipo de soporte en <a href="mailto:support@konectai.example.com" class="text-indigo-600 hover:text-indigo-500">support@konectai.example.com</a>.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-16 pt-10 border-t border-gray-200">
            <div class="text-center">
                 <h3 class="text-2xl font-semibold text-gray-900">¿Necesitas más Ayuda? ¡Chatea con Nosotros!</h3>
            </div>
            {# Modified section for n8n chat widget #}
            <div id="n8n-chat-widget-container" class="mt-6 bg-gray-100 p-4 rounded-md min-h-[300px] flex flex-col justify-center items-center border border-gray-300 shadow-sm">
                <!-- TODO: Embed n8n Chat Widget Here -->
                <p class="text-center text-gray-600">
                    El Asistente Virtual está casi listo.
                </p>
                <p class="text-center text-red-500 font-semibold mt-2">
                    Integración del Chatbot pendiente: El código del widget de n8n (URL/snippet) necesita ser añadido aquí.
                </p>
                <p class="text-center text-sm text-gray-500 mt-1">
                    (Esta sección mostrará la interfaz de chat interactiva.)
                </p>
            </div>
            <p class="mt-4 text-sm text-gray-500 text-center">Nuestro chatbot puede ayudar a responder preguntas comunes. Si no puede ayudarte, te guiará sobre cómo contactar a nuestro equipo de soporte.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{# {{ super() }} #} {# Uncomment if base.html defines a 'scripts' block and you want to extend it #}
<script>
    (function() { // IIFE to avoid polluting global scope
        // TODO: n8n Chat Widget Initialization Script will go here.
        // This script should be provided by n8n or your chat widget solution.
        // It will likely target the 'n8n-chat-widget-container' div.
        console.log("Attempting to initialize n8n chat widget placeholder...");

        const chatContainer = document.getElementById('n8n-chat-widget-container');
        if (!chatContainer) {
            console.error("Chat widget container 'n8n-chat-widget-container' not found.");
            return;
        }

        // Example of how you might pass user data if needed by your widget:
        let widgetConfig = {
            context: 'help_page'
            // Add other default configurations here
        };

        {% if current_user.is_authenticated %}
        // User is authenticated, pass their ID and profile.
        widgetConfig.userId = "{{ current_user.id_usuario }}";
        widgetConfig.userProfile = "{{ current_user.perfil }}";
        // Potentially add other user-specific data if your widget supports it
        // widgetConfig.userName = "{{ current_user.nombre }}";
        // widgetConfig.userEmail = "{{ current_user.email }}";

        console.log("User is authenticated. Prepared widget config:", widgetConfig);
        {% else %}
        // User is not authenticated.
        console.log("User is not authenticated. Prepared widget config:", widgetConfig);
        {% endif %}

        // --- Placeholder for actual n8n widget initialization ---
        // Replace this with the actual script provided by n8n or your chat solution.
        // Example (this is purely illustrative):
        // if (typeof YourN8NWidget !== 'undefined') {
        //     YourN8NWidget.init(chatContainer, widgetConfig);
        // } else {
        //    console.warn("YourN8NWidget script not loaded. Chat cannot be initialized.");
        //    // The placeholder text in the div will remain visible.
        // }
        // For now, we just log the config that would be used.
        console.log("Placeholder: n8n widget would be initialized with config:", widgetConfig);

    })();
</script>
{% endblock %}
